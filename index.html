<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>ibonarium :: jwst slow modes</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="robots" content="noindex,nofollow">

<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{
    width:100%;
    height:100%;
    background:#000;
    color:#cfefff;
    font-family:Inter,system-ui,monospace;
    overflow:hidden;
}

/* ===== JWST BACKGROUND ===== */
#jwst-bg{
    position:fixed;
    inset:0;
    background-size:cover;
    background-position:center;
    transform:scale(1);
    transition:opacity 2s ease, filter 1.5s ease;
    opacity:0;
    filter:brightness(0.85) contrast(1.05);
    will-change:transform;
}

@keyframes driftSoft{
    0%{transform:scale(1)}
    100%{transform:scale(1.01)}
}

@keyframes driftMedium{
    0%{transform:scale(1) translate(0,0)}
    50%{transform:scale(1.02) translate(-1%,-1%)}
    100%{transform:scale(1.01) translate(1%,1%)}
}

/* ===== IR FILTER ===== */
.ir{
    filter:
        brightness(0.9)
        contrast(1.2)
        saturate(1.4)
        hue-rotate(35deg);
}

/* ===== OVERLAY ===== */
#overlay{
    position:fixed;
    inset:0;
    background:radial-gradient(circle at center, rgba(0,0,0,0.2), #000 80%);
    pointer-events:none;
}

/* ===== UI ===== */
#controls{
    position:absolute;
    top:20px;
    left:20px;
    display:flex;
    gap:8px;
}

button{
    background:rgba(0,0,0,0.45);
    border:1px solid rgba(255,255,255,0.15);
    color:#cfefff;
    padding:6px 10px;
    border-radius:10px;
    cursor:pointer;
    font-size:13px;
}

button.active{
    border-color:#fff;
    color:#fff;
}

#panel{
    position:absolute;
    bottom:20px;
    left:20px;
    background:rgba(0,0,0,0.45);
    backdrop-filter:blur(6px);
    padding:14px 18px;
    border-radius:12px;
    font-size:14px;
    line-height:1.5;
    max-width:420px;
}

#panel b{color:#fff}
</style>
</head>

<body>

<div id="jwst-bg"></div>
<div id="overlay"></div>

<div id="controls">
    <button onclick="setMode('silence')">Тиша</button>
    <button onclick="setMode('memory')">Памʼять</button>
    <button onclick="setMode('novelty')">Новизна</button>
    <button onclick="toggleIR()">IR</button>
</div>

<div id="panel">
    <b>JWST Slow Observer</b><br>
    Режим: <span id="modeLabel"></span><br>
    <span id="meta"></span>
</div>

<script>
const CACHE_KEY = "jwst_mode_cache";
let currentMode = "memory";
let irEnabled = false;

function cacheDuration(mode){
    if(mode==="silence") return 72*60*60*1000;
    if(mode==="novelty") return 6*60*60*1000;
    return 24*60*60*1000;
}

async function loadJWST(){
    const cached = localStorage.getItem(CACHE_KEY);
    if(cached){
        const data = JSON.parse(cached);
        if(Date.now()-data.time < cacheDuration(data.mode)){
            apply(data);
            return;
        }
    }

    const page = currentMode==="memory"
        ? Math.floor(Math.random()*50)+1
        : 1;

    const query = {
        service:"Mast.Caom.Filtered",
        params:{
            columns:"obs_id,target_name,instrument_name,release_date",
            filters:[
                {paramName:"obs_collection",values:["JWST"]},
                {paramName:"dataproduct_type",values:["image"]},
                {paramName:"dataRights",values:["PUBLIC"]}
            ]
        },
        format:"json",
        pagesize:1,
        page:page
    };

    const res = await fetch("https://mast.stsci.edu/api/v0/invoke",{
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body:JSON.stringify(query)
    });

    const json = await res.json();
    if(!json.data?.length) return;

    const obs = json.data[0];
    const img =
        `https://mast.stsci.edu/portal/Download/file/JWST/product/${obs.obs_id}_i2d.jpg`;

    const payload = {
        img,
        target:obs.target_name,
        instrument:obs.instrument_name,
        release:obs.release_date,
        mode:currentMode,
        time:Date.now()
    };

    localStorage.setItem(CACHE_KEY, JSON.stringify(payload));
    apply(payload);
}

function apply(d){
    const bg = document.getElementById("jwst-bg");
    bg.style.backgroundImage = `url(${d.img})`;
    bg.style.opacity = "1";

    bg.style.animation =
        d.mode==="silence"
            ? "driftSoft 300s linear infinite"
            : "driftMedium 180s linear infinite";

    document.getElementById("modeLabel").textContent =
        d.mode==="silence"?"Тиша":d.mode==="memory"?"Памʼять":"Новизна";

    document.getElementById("meta").innerHTML =
        `Ціль: ${d.target}<br>
         Інструмент: ${d.instrument}<br>
         Реліз: ${d.release}`;
}

function setMode(m){
    currentMode = m;
    document.querySelectorAll("button").forEach(b=>b.classList.remove("active"));
    event.target.classList.add("active");
    loadJWST();
}

function toggleIR(){
    irEnabled = !irEnabled;
    document.getElementById("jwst-bg").classList.toggle("ir", irEnabled);
}

loadJWST();
</script>

</body>
</html>
