<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>ibonarium :: JWST Live Viewer</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{
    width:100%;height:100%;
    background:#000;color:#cfefff;
    font-family:Inter,system-ui,monospace;
    overflow:hidden;
}

#jwst-bg{
    position:fixed;inset:0;
    background-size:cover;
    background-position:center;
    opacity:0;
    transition:opacity 2s ease, filter 1s ease;
}

.ir{
    filter:brightness(0.85) contrast(1.25) saturate(1.3) hue-rotate(35deg);
}

#overlay{
    position:fixed;inset:0;
    background:radial-gradient(circle at center, rgba(0,0,0,0.25), #000 80%);
    pointer-events:none;
}

#controls{
    position:absolute;top:16px;left:16px;
    display:flex;gap:8px;
}

button{
    background:rgba(0,0,0,0.45);
    border:1px solid rgba(255,255,255,0.15);
    color:#cfefff;
    padding:6px 10px;
    border-radius:10px;
    cursor:pointer;
    font-size:13px;
}

button.active{
    border-color:#fff;
    color:#fff;
}

#panel{
    position:absolute;bottom:16px;left:16px;
    background:rgba(0,0,0,0.45);
    backdrop-filter:blur(6px);
    padding:12px 16px;
    border-radius:12px;
    font-size:14px;
    line-height:1.5;
    max-width:420px;
}
</style>
</head>
<body>

<div id="jwst-bg"></div>
<div id="overlay"></div>

<div id="controls">
    <button onclick="setMode('silence')">Тиша</button>
    <button onclick="setMode('memory')">Памʼять</button>
    <button onclick="setMode('novelty')">Новизна</button>
    <button onclick="toggleIR()">IR</button>
</div>

<div id="panel">
    <b>JWST Observer</b><br>
    Режим: <span id="modeLabel"></span><br>
    <span id="meta"></span>
</div>

<script>
// ====== Твій JWST API ключ ======
const API_KEY = "a1686b45-a59a-478c-85a3-cc44c95ea90e";

let currentMode = "memory";
let irOn = false;
let images = []; // Масив для превʼю
let lastIndex = -1;

// Встановлення режиму
function setMode(mode){
    currentMode = mode;
    document.querySelectorAll("button").forEach(b=>b.classList.remove("active"));
    event.target.classList.add("active");
    showNextImage();
}

// IR-фільтр
function toggleIR(){
    irOn = !irOn;
    document.getElementById("jwst-bg").classList.toggle("ir", irOn);
}

// Завантажуємо останні 50 фото з JWST API
async function loadImages(){
    try{
        const url = `https://jwstapi.com/api/v1/images?key=${API_KEY}&limit=50`;
        const res = await fetch(url);
        const json = await res.json();

        if(json && json.data && json.data.length){
            // Фільтруємо лише ті, які мають previewUrl або downloadUrl
            images = json.data.filter(i => i.previewUrl || i.downloadUrl)
                              .map(i => ({
                                  url: i.previewUrl || i.downloadUrl,
                                  title: i.title || "—",
                                  instrument: i.instrument || "—",
                                  date: i.obsDate || "—"
                              }));
            showNextImage();
        } else {
            console.warn("JWST API не повернув зображень");
        }
    } catch(e){
        console.error("Помилка при завантаженні JWST API:", e);
    }
}

// Показ наступного фото залежно від режиму
function showNextImage(){
    if(!images.length) return;

    let selected;

    if(currentMode === "novelty"){
        selected = images[0]; // найновіше
    } else if(currentMode === "memory"){
        const idx = Math.floor(Math.random() * Math.min(images.length,30));
        selected = images[idx];
    } else { // Тиша
        selected = images[images.length - 1];
    }

    lastIndex = images.indexOf(selected);
    displayImage(selected);
}

// Показ зображення та метаданих
function displayImage(item){
    const bg = document.getElementById("jwst-bg");
    bg.style.backgroundImage = `url(${item.url})`;
    bg.style.opacity = "1";

    document.getElementById("meta").innerHTML =
        `Назва: ${item.title}<br>` +
        `Камера: ${item.instrument}<br>` +
        `Дата: ${item.date}`;
}

// Автооновлення кожні 60 секунд (повільний фон)
setInterval(()=>{
    if(images.length && currentMode !== "novelty"){
        let nextIndex = (lastIndex + 1) % images.length;
        lastIndex = nextIndex;
        displayImage(images[nextIndex]);
    }
}, 60000); // змінюємо фото кожну хвилину

// Перший запуск
document.getElementById("modeLabel").textContent = currentMode;
loadImages();
</script>

</body>
</html>
